# 推送厂商消息分类使用指南

## 华为

### 华为消息推送限制

#### 华为每日推送数量上限要求

根据[消息分类标准](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-classification-0000001149358835)，华为推送服务将通知消息分为资讯营销、服务与通讯两大类别。资讯营销类消息的每日推送数量自2023年01月05日起根据应用类型对推送数量进行上限管理，服务与通讯类消息每日推送数量不受限。

| 消息分类         | 类型说明       | 推送数量限制          |
| :------ | :--------------------- | :------------- |
| 资讯营销类消息   | 内容资讯：内容推荐，新闻，财经动态，生活资讯，社交动态，调研，其他。营销活动：产品促销，功能推荐，运营活动。具体类别请参见[资讯营销类消息场景说明](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-classification-0000001149358835#section171976503205)。 | 根据应用类别限制每日推送数量，具体要求参见[不同应用类别的推送数量上限要求](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-restriction-description-0000001361648361#section199311418515)。 |
| 服务与通讯类消息 | 社交通讯：即时聊天，音频、视频通话。服务提醒：订阅，出行，健康，工作事项提醒，帐号动态，订单&物流，财务，设备提醒，系统提示，邮件。具体类别请参见[服务与通讯类消息场景说明](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-classification-0000001149358835#section13920133101416)。 | 无限制。     |

#### 华为不同应用类别的推送数量上限要求

针对接入华为推送服务设备上的通知栏中的资讯营销类消息，将根据应用类别对每日推送数量进行上限管理。

| 二级分类        | 三级分类         | 单个应用每日每设备通知推送数量（单位：条） |
| :------------------ | :-------------------- | :---------------------- |
| 新闻阅读                    | 新闻（需具备《互联网新闻信息服务许可证》） | 5                                          |
| 电子书、杂志、有声读书、动漫、幽默、体育、分类信息 | 2                                          |                                            |
| 休闲益智   | 所有           | 2                                          |
| 经营策略                                           | 所有                                       | 2                                          |
| 体育竞技                                           | 所有                                       | 2                                          |
| 棋牌桌游                                           | 所有                                       | 2                                          |
| 动作射击                                           | 所有                                       | 2                                          |
| 角色扮演                                           | 所有                                       | 2                                          |
| 影音娱乐                                           | 所有                                       | 2                                          |
| 实用工具                                           | 所有                                       | 2                                          |
| 社交通讯                                           | 所有                                       | 2                                          |
| 教育                                               | 所有                                       | 2                                          |
| 新闻阅读                                           | 所有                                       | 2                                          |
| 拍摄美化                                           | 所有                                       | 2                                          |
| 美食                                               | 所有                                       | 2                                          |
| 出行导航                                           | 所有                                       | 2                                          |
| 旅游住宿                                           | 所有                                       | 2                                          |
| 购物比价                                           | 所有                                       | 2                                          |
| 商务                                               | 所有                                       | 2                                          |
| 儿童                                               | 所有                                       | 2                                          |
| 金融理财                                           | 所有                                       | 2                                          |
| 运动健康                                           | 所有                                       | 2                                          |
| 便捷生活                                           | 所有                                       | 2                                          |
| 汽车                                               | 所有                                       | 2                                          |
| 主题个性                                           | 所有                                       | 2                                          |

详情请看[华为推送文档](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-restriction-description-0000001361648361)。

#### 华为推送速率QPS限制

华为推送对推送速度的分配，主要依据App在华为终端上的月活、App在华为应用市场上架时的应用类型这两个要素进行计算分配。

应用QPS=App在华为终端上MAU(Monthly Active User)×应用类别权重×整体分配系数（0.00072）。

QPS(Quantity per second)：表示1秒可以发送的推送条数。

应用在华为终端上MAU查询路径：“华为开发者联盟 > 管理中心 > 应用服务 > AppGallery Connect > 我的项目 > 推送服务 > 推送报告 > 推送用户详情 > 30日活跃用户数”

应用类别：指的是应用在应用市场上架时选择的应用二级分类，查询路径：“华为开发者联盟 > 管理中心 > 应用服务> AppGallery Connect > 我的应用 > 应用信息 > 应用分类 > 应用二级分类”。

应用类别权重列表：

| 分组名称   | 应用分类                           | 权重系数 |
| :--------- | :--------------------------------- | :------- |
| IM类       | 社交通讯                           | 5        |
| 金融类     | 金融理财                           | 5        |
| 新闻类     | 新闻阅读；资讯生活                 | 4        |
| 内容类     | 图书阅读；影音娱乐；拍摄美化       | 3        |
| 电商类     | 购物比价                           | 3        |
| 衣食住行类 | 便捷生活；出行导航；美食；旅游住宿 | 3        |
| 商务类     | 商务                               | 3        |
| 游戏类     | 网络游戏；休闲益智；经营策略；棋牌 | 2        |
| 工具类     | 实用工具                           | 1        |
| 运动健康类 | 医疗健康；运动健康                 | 1        |
| 其他类     | 儿童；教育；主题个性；汽车         | 1        |
| Default    | Default（未上架）                  | 1        |

若您的应用通过QPS公式计算所得的值不足6000，将执行默认6000的QPS；同时，全网流量较高时，也会出现系统级流控（流控对应的状态码为HTTP 503）。

QPS计算规则只适用于中国大陆。

#### 华为Push消息长度限制

应用包名最大支持128字节，消息内容最大支持4K字节（不包括Push Token）。

### 华为消息分类标准

华为将根据消息分类方案对不同类别消息的提醒方式、消息样式进行差异化管理，具体如下：

| 消息类型   | 定义      | 提醒方式     | 消息样式                                                     |
| :--------- | :---------- | :------- | :------------------------------ |
| 服务与通讯 | 包括社交通讯类消息和服务提醒类消息。社交通讯，指用户间的聊天消息、通话等信息。服务提醒，指应用借助通知中心及时向用户传递重要通知提醒，通常用户对接收此类消息有预期。 | 锁屏、铃声、振动                   | 文本+小图（可选）<br/>![img](@static/images/instantpush/push_huawei_tinyimage1.png)|
| 资讯营销   | 包括资讯类消息和营销类消息，指的是运营人员向用户发送的活动信息、内容推荐、资讯等。 | 静默通知，仅在下拉通知栏时展示消息 | 文本+小图（可选）<br/>![img](@static/images/instantpush/push_huawei_tinyimage2.png) |

#### 华为消息分类方式

华为消息分类方式有两种，默认情况下，所有消息一律通过通知消息智能分类功能进行分类。如您希望消息分类能更精准地符合业务需要，您也可以申请自分类权益，我们将信任您所提供的分类信息，按照您提供的分类标准展示对应消息。

##### 消息智能分类

智能分类算法将根据您发送的内容等多个维度因素，自动将您的消息按照分类标准归类为服务与通讯类或者资讯营销类消息。

##### 消息自分类

华为推送服务接受开发者自分类权益的申请。当您申请成功后，允许开发者根据华为推送分类规范，自行对消息进行分类。

举例：具有消息自分类权益且申请了自分类消息类型IM消息，当您发送消息时携带category字段且赋值为“IM”，则该消息的提醒方式为锁屏+铃声+震动。

#### 华为自分类权益申请

自分类申请详情参见 [华为消息分类管理方案](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides-V5/message-classification-management-solution-0000001149358835-V5#ZH-CN_TOPIC_0000001149358835__section153801515616)。

- 若应用没有自分类权益，则应用的推送消息将通过智能分类进行自动归类。
- 若应用有自分类权益，将信任开发者提供的分类信息，消息不经过智能分类。

#### 华为消息分类使用

消息分类的申请审核通过后，即可指定 importance 进行下发， 该参数在 options 可选参数的 third_party_channel 字段下。

| 关键字   | 类型   | 选项 | 含义   | 说明                                                         |
| :--------- | :----- | :--- | :------ | :----------- |
| importance | string | 可选 | 华为通知栏消息智能分类 | 取值为”LOW”时，表示消息为资讯营销。取值为”NORMAL”时，表示消息为服务与通讯。 |
| category   | string | 可选 | 华为厂商消息场景标识   | 为了适配华为手机厂商消息，完成[自分类权益申请](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-Guides/message-classification-0000001149358835#section3410731125514) 后，用于标识消息类型，确定消息提醒方式，对特定类型消息加快发送。对应值及其说明参考 [category 值说明](https://developer.huawei.com/consumer/cn/doc/development/HMSCore-References/https-send-api-0000001050986197#ZH-CN_TOPIC_0000001134031085__p5203378238)。若应用没有自分类权益，或应用有自分类权益但推送消息不携带 category 字段，则应用的推送消息将通过智能分类进行自动归类。若应用有自分类权益且推送消息携带category字段，将信任开发者提供的分类信息，消息不经过智能分类。 |

## OPPO

### 消息推送限制

#### 推送数量限制

目前OPPO PUSH推送数量限制的规则是：

![img](@static/images/instantpush/push_oppo_quantityrestriction.png)

通知栏推送测试权限与正式权限仅有推送数量上的差异，api推送环境都使用正式环境。

累计用户是指从接入OPPO PUSH的App客户端，用户安装并激活的累计用户量，去除已卸载用户数。

累计用户数在[OPPO推送运营平台](https://push.oppo.com/)可查询，每天会刷新。

目前私信处于公测阶段，需要申请才能开启私信通道，私信申请请参考[OPPO PUSH通道升级公测邀请](https://open.oppomobile.com/wiki/doc#id=10614)

:::notice
OPPO推送服务将于2023年1月15日优化推送数量限制规则，对已申请正式权限的应用增加区分应用类别的推送频控限制。
:::

![img](@static/images/instantpush/push_oppo_singleuser.png)

具体限制请参考[OPPO推送文档](https://open.oppomobile.com/new/developmentDoc/info?id=11210)。

#### 推送速率QPS限制

OPPO暂未对外公布详细推送速率限制。

#### PUSH消息长度限制

通知标题：50字符（中英文均以一个计算）

通知内容：200字符（中英文均以一个计算）

:::notice
超过限制则该条消息无法通过OPPO厂商通道发送，环信在线通道不受影响。
:::

### 消息分类标准

OPPO PUSH将消息分为私信消息和公信消息两类。私信消息是针对用户有一定关注度，且希望能及时接收的信息，如即时聊天信息、个人订单变化、快递通知、订阅内容更新、评论互动、会员积分变动等，与单个用户信息强相关的内容。

公信消息是针对用户关注度不高，且对于接收这类信息并无心理预期，如热点新闻、新品推广、平台公告、社区话题、有奖活动等，多用户普适性的内容。

| 类型    | 私信信道          | 公信信道               |
| :--------- | :--------------- | :----------------- |
| 推送数量限制  | 不限量  | 有公信类通道共享推送次数，当日达到推送量限制后，所有公信类通道将无法再推送消息； 推送限量：当累计用户数<50000时，按100000/日计算；当累计用户数≥50000时，累计用户数*2/日。 |
| 单设备推送条数限制 | 不限量     | 新闻类（三级分类为新闻类）：5条/日 其他应用类型：2条/日   |
| 配置方式 | 客户端[适配通道](https://open.oppomobile.com/new/developmentDoc/info?id=11251)、并且邮件申请通过后，需要在[OPPO推送平台](https://push.oppo.com/)上登记该通道，并将通道对应属性设置为“私信” | 默认开通  |
| 服务端推送方法     | “[单点推送](https://open.oppomobile.com/new/developmentDoc/info?id=11238)”api（服务端SDK对应unicastNotification、unicastBatchNotification方法），channel_id带上私信通道的通道ID | “单点推送”和“广播推送”都支持。   |
| 消息类型限制  | 私信消息（通过私信模板限制）     | 不限制，公信消息/私信消息均可。     |

#### OPPO私信通道使用

1.[创建客户端自定义渠道](https://docs.jiguang.cn/jpush/client/Android/android_api#notificationchannel-配置)，channel_id 须与OPPO 官网登记的通道 ID 一致。

2.API 推送。

channel_id 参数在 notification 的 android 字段下。

| 关键字   | 类型   | 选项 | 含义      | 说明        |
| :--------- | :----- | :--- | :------ | :------------ |
| channel_id | string | 可选 | android 通知 channel_id | 不超过1000字节，Android 8.0开始可以进行 [NotificationChannel 配置](https://docs.jiguang.cn/jpush/client/Android/android_api#notificationchannel-配置)，这里根据 channel ID 来指定通知栏展示效果。 |

## 小米

### 消息推送限制

小米推送消息限制分为每日推送数量限制，推送速率QPS限制和推送消息长度限制。

具体请参考小米官方文档[小米推送限制说明](https://dev.mi.com/console/doc/detail?pId=2086)。

#### 推送数量限制

![img](@static/images/instantpush/push_mi_pushrestriction.png)

如果特殊情况需要额外提升推送量级，开发者可以向小米推送进行申诉。

申诉方法：

发邮件至邮箱[mipush-permission@xiaomi.com](mailto:mipush-permission@xiaomi.com)。

邮件模板：

主题：xxx应用申请增加普通消息发送量级

正文：

应用名称：

AppID：

应用简介：

申请的推送量级：

申请原因：

（1）推送场景的详细说明（必填）

（2）用户因收不到推送的投诉（选填）

（3）或者其他可以证明增加推送量级合理性的材料（选填）。

小米推送将在5个工作日内答复审核结果。

#### 推送速率QPS限制

##### 限制规则

小米推送对推送速率（QPS）的分配主要依据App的MIUI日联网设备数进行分级计算。

QPS：表示1秒可调用的请求数。1个请求里最多可以携带1000个目标设备。例如：3000 QPS时，1秒内最多可推送300万设备。

MIUI日联网设备数的查询路径：推送运营平台-推送统计-用户数据-数据详情

不同量级的MIUI日联网设备数分配不同的QPS：

| MIUI日联网设备数 | QPS  |
| :--------------- | :--- |
| ≥1000万          | 3000 |
| ≥500万且<1000万  | 2500 |
| ≥100万且<500万   | 2000 |
| ≥10万且<100万    | 1000 |
| <10万            | 500  |

#### Push消息长度限制

通知标题：50字符（中英文字符均计算为1）

通知内容：128字符（中英文字符均计算为1）

:::notice
超过限制则该条消息无法通过小米厂商通道发送，环信在线通道不受影响。
:::

### 消息分类标准

小米推送将消息分为“**私信消息**”和“**公信消息**”两个类别，不同类别对应不同的权限，具体映射关系如下：

| **消息类型** | **划分原则**  | **推送内容**  | **管控规则**     | **提醒方式** | **申请方式**   |
| :----------- | :------------- | :--------- | :------------ | :----------- | :------- |
| 私信消息     | 用户主动订阅、对收到此类消息有预期，或需要及时知道的消息等，如果错过可能会导致不良影响。 | 即时消息、个人账户、个人资产、个人订阅、个人日程、设备信息、订单及物流、工作信息。 | 每日推送数量无限制； 用户接收数量无限制。                    | 响铃、振动   | 在推送运营平台申请，具体参见“[2. channel申请及接入方法](https://dev.mi.com/console/doc/detail?pId=2422#_2)”。 |
| 公信消息     | 用户对收到此类消息无预期，关注程度较低。                     | 新闻资讯、内容资讯、生活资讯、关注推荐、算法推荐、平台活动、互动信息、其他消息。 | 严格限制每日推送、接收数量，具体限制规则请参见“[消息限制说明](https://dev.mi.com/console/doc/detail?pId=2086)”。 | 无           |                                                              |

2023年2月1日起按照本新规中的消息分类正式运行。

小米重要级别消息申请

申请方式请参见小米官方文档 [channel 申请及接入方法](https://dev.mi.com/console/doc/detail?pId=2422#_2)。

#### 小米消息分类使用

channel_id 参数在 notification 的 android 字段下。

| 关键字     | 类型   | 选项 | 含义    | 说明       |
| :--------- | :----- | :--- | :-------- | :------ |
| channel_id | string | 可选 | android 通知 channel_id | 不超过1000字节，Android 8.0开始可以进行 [NotificationChannel 配置](https://docs.jiguang.cn/jpush/client/Android/android_api#notificationchannel-配置)，这里根据 channel ID 来指定通知栏展示效果。 |