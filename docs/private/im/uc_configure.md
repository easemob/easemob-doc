# 开通配置环信即时通讯 IM 服务

<Toc />

## 前提条件

配置环信即时通讯 IM 服务前，请确保已经具备以下条件：

- 已部署私有化即时通讯服务。

## 创建应用

参照以下步骤在环信即时通讯云控制台创建应用和配置即时通讯 IM 服务。

1. 登录环信即时通讯云控制台，在首页的**应用列表**区域点击 **创建应用** 按钮，创建即时通讯 IM 应用。

![img](@static/images/privitization/deploy_index.png)

2. 在 **创建应用** 对话框中，输入新应用的相关信息，点击 **创建** 按钮创建应用。

:::notice
1. `appname`：你设置的应用名称，用于生成 App Key。该参数的值只能包含小写字母、数字和连字符，不能超过 32 个字符。
2. `Appkey`：即时通讯服务分配给每个应用的唯一标识，由 `orgname` 和 `appname` 参数的值组成，生成后无法修改。
:::

![img](@static/images/privitization/deploy_create_app.png)



## 获取环信即时通讯 IM 的信息

在环信即时通讯云控制台，你可以查看你的环信即时通讯 IM 服务的如下信息：

| 应用信息       | 描述   | 如何查看 | 
| :--------- | :----- | :------- | 
| `Orgname`     | 环信即时通讯 IM 为每个公司（组织）分配的唯一标识。该参数是 `APPKEY` 的一部分。 | 在环信即时通讯云控制台的 **应用详情** 页面查看。 |
| `Appname` | 你在环信即时通讯云控制台创建应用时填入的应用名称。该参数是 `AppKey` 的一部分。| 在环信即时通讯云控制台的 **应用详情** 页面查看。 |
| `APPKEY` | 应用的唯一标识，由 `Orgname` 和 `Appname` 组成，生成后不允许修改。     | 在环信即时通讯云控制台的 **应用详情** 页面查看。 |

## 查看和配置功能

创建应用后，参照以下步骤在环信即时通讯云控制台上查看环信即时通讯 IM 服务的详情以及进行配置。

在环信即时通讯云控制台的首页的 **应用列表** 中，点击目标应用的 **操作** 栏中的 **管理** 按钮，在左侧导航栏选择 **服务管理** > **服务概览** ，您可以查看到当前 App Key 的服务配置并根据实际业务需求管理相关配置，具体操作说明如下：

1. **免费开通**：指该功能当前服务版本里已包含，可根据实际业务需求选择是否开通；点击 **免费开通**，则可立即开通该功能；
2. **设置**：指该功能已开通且有需要设置的配置项，点击 **设置**，即可进入对应设置页配置；
3. **可调整，联系商务升级**：功能如果当前服务版本中不包含、或需要提高功能状态中的参数值，则通过联系商务调整升级至符合业务需求的服务版本即可；

![img](@static/images/privitization/deploy_service.png)

## 设置消息撤回（REST & 客户端）

1. 在环信即时通讯云的左侧导航栏中，选择**服务管理** > **服务概览**。在 **服务概览** 页面下，搜索找到消息撤回（REST&客户端），单击右侧的 **设置**（已开通状态下）。
2. 在弹出的 **消息撤回时间设置** 对话框中，设置消息可撤回时长。端消息撤回时长和 REST 消息撤回时长均不能超过 7 天。
3. 单击 **确定** 保存配置。

![img](@static/images/privitization/deploy_rest.png)

## 配置推送证书

使用离线推送通知之前，需完成各平台的证书配置。当前支持以下平台：苹果 APNs、谷歌 FCM、华为、小米、OPPO、VIVO 和魅族。

开启环信即时通讯 IM 服务后，按照以下步骤添加消息推送证书：

1. 在环信即时通讯云控制台首页的**应用列表**中，在目标应用的 **操作** 栏中，点击 **管理**。

![img](@static/images/privitization/deploy_credentials.png)

2. 在左侧导航栏，选择 **即时推送** > **配置证书**，进入 **配置证书** 页面。

![img](@static/images/privitization/deploy_push_settings.png)

3. 点击 **添加推送证书** 按钮，打开 **添加推送证书** 对话框。


![img](@static/images/privitization/deploy_push-settings_window.png)

4. 在 **添加推送证书** 对话框中，填写各厂商平台的相关推送信息，点击 **保存** 按钮，完成证书配置。

![img](@static/images/privitization/deploy_push-settings_form.png)

## 配置消息回调

环信即时通讯 IM 提供消息回调服务。配置回调后，应用服务器会收到所选类型的消息和事件。

购买环信即时通讯 IM 服务后，按照以下步骤添加消息回调证书：

1. 在环信即时通讯云控制台首页的**应用列表**中，在目标应用的 **操作** 栏中点击 **管理**。

![img](@static/images/privitization/deploy_credentials.png)

2. 在左侧导航栏，选择 **服务管理** > **回调服务**，进入 **回调服务** 页面。

![img](@static/images/privitization/deploy_push_callback.png)

3. 点击 **添加回调地址** 按钮，打开回调配置对话框，在回调配置对话框中，填写回调相关配置信息，点击 **保存** 按钮，完成回调配置，具体配置内容说明见 [回调配置](/document/server-side/callback.html#实现步骤)。

![img](@static/images/privitization/deploy_push_window.png)


## 敏感词设置

1. 在环信即时通讯云的左侧导航栏中，选择 **服务管理** > **敏感词服务** 。
2. 在敏感词配置页面，单击 **添加敏感词**，在弹出的 **添加敏感词** 对话框中，自定义敏感词库。
3. 单击 **确定** 保存配置。

![img](@static/images/privitization/deploy_sensitive_words.png)

## REST-IP 白名单设置

### 添加 IP 白名单

1. 在环信即时通讯云的左侧导航栏中，选择 **服务管理** > **白名单服务** 。
2. 在 **白名单服务** 页面，单击 **添加IP**，在弹出的 **添加 IP** 对话框中，输入 IP 地址。
:::notice
1. 每次只能输入 1 个 IP 地址，最多可添加 8 个。
2. 添加 IP 地址成功后 10 分钟后生效。
3. 若白名单列表为空，则所有 IP 地址均可发 REST 消息。
:::
3. 单击 **保存** 完成配置。
![img](@static/images/privitization/deploy_ip_whitelist.png)

### 删除 IP 白名单

如果你不再允许某个 IP 地址继续发送 REST 消息，可以在 IP 白名单中将其删除。如果你删除了 IP 白名单中所有 IP，即白名单列表为空，则默认所有 IP 地址均可发送 REST 消息。

1. 在环信即时通讯云的左侧导航栏中，选择  **服务管理** > **白名单服务**。

2. 在 **IP白名单** 列表中，单击目标 IP 右侧的 **删除**。

![img](@static/images/privitization/deploy_ip_allow_list.png)

3. 单击 **确认**，则删除该 IP 地址。
